#!/bin/bash

#Prerequisites:
#
# - the AtGENOME directory in the location identified in AtPEAT.configfile
#   (with processing done as specified in the AtGENOME/0README file)
#
# - the AtPEAT/downloads directory in the location identified in
#   AtPEAT.configfile. The directory should include the MT_*.fastq read files
#   provided by the study authors. Alternatively, you can use the authors'
#   peat.sorted.bam alignment file and change scripts/xmkBAMDIR to use those
#   alignments instead of the alignments generated by xmkBAMDIR from the
#   MT_*.fastq read files.

#Setting variables:
#
DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
source ${DIR}/AtPEAT.configfile

#No further edits necessary from here on ...
#


#Processing the downloaded reads or alignments:
#
${SCRIPTS}/xmkBAMDIR

#Counting TSS tags and determining TSRs with TSRchitect:
#
cd tsr
mkdir BAMDIR
cd BAMDIR
ln -s ../../BAMDIR/${EXPERIMENT}.genome.bam ./
ln -s ${BASEDIR}/${GENOME_DIR}/${GENOME_GFF} AtGenome.gff3
cd ..
echo "... now running Rscript ${EXPERIMENT}-wf*.Rscript"
time ./xrunAwf all
